<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hibt - Trading Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #f5f5f5;
            overflow-x: hidden;
        }
        
        /* Auth Container */
        .auth-container { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
        }
        .auth-box { 
            background: white; 
            border-radius: 20px; 
            padding: 40px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            width: 90%; 
            max-width: 400px; 
        }
        .auth-title { 
            font-size: 24px; 
            font-weight: 600; 
            margin-bottom: 30px; 
            text-align: center; 
            color: #333;
        }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; }
        input, select { 
            width: 100%; 
            padding: 15px; 
            border: 2px solid #e1e5e9; 
            border-radius: 12px; 
            font-size: 16px; 
        }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        .btn { 
            width: 100%; 
            padding: 15px; 
            border: none; 
            border-radius: 12px; 
            font-size: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            margin-top: 20px; 
        }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover:not(:disabled) { background: #5a67d8; }
        .switch-text { margin-top: 20px; color: #6c757d; text-align: center; }
        .switch-link { color: #667eea; cursor: pointer; text-decoration: underline; }
        .message { padding: 10px; border-radius: 8px; margin-bottom: 15px; font-weight: 500; }
        .error { background: #fee; color: #c33; border: 1px solid #fcc; }
        .success { background: #efe; color: #363; border: 1px solid #cfc; }
        .hidden { display: none; }
        
        /* Main App */
        .app { display: none; min-height: 100vh; background: #f5f5f5; }
        .app.active { display: block; }
        
        /* Header Banner */
        .header-banner {
            background: linear-gradient(135deg, #4285f4 0%, #1e3c72 100%);
            padding: 30px 20px;
            color: white;
            position: relative;
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .brand { font-size: 28px; font-weight: bold; }
        .header-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .icon-btn {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            border: none;
            color: white;
        }
        .icon-btn:active { background: rgba(255,255,255,0.3); }
        .tagline {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        /* Total Assets Display */
        .total-assets-container {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .total-assets-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        .total-assets-value {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .total-assets-amount {
            font-size: 32px;
            font-weight: bold;
        }
        .eye-icon {
            cursor: pointer;
            font-size: 24px;
            opacity: 0.8;
        }
        .eye-icon:hover { opacity: 1; }
        .assets-hidden {
            font-size: 32px;
            font-weight: bold;
        }
        
        .logo-box {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-left: auto;
        }
        
        /* Market Section */
        .market-section {
            padding: 20px;
        }
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        .coin-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .coin-card {
            background: white;
            border-radius: 16px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .coin-card:active { transform: scale(0.98); }
        .coin-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
        }
        .coin-info {
            flex: 1;
        }
        .coin-name {
            font-weight: 600;
            font-size: 15px;
            color: #333;
        }
        .coin-symbol {
            font-size: 12px;
            color: #888;
            margin-top: 2px;
        }
        .coin-graph {
            width: 60px;
            height: 30px;
        }
        .coin-price-info {
            text-align: right;
        }
        .coin-price {
            font-weight: 600;
            font-size: 15px;
            color: #333;
        }
        .coin-change {
            font-size: 11px;
            margin-top: 2px;
        }
        .coin-change.positive { color: #4caf50; }
        .coin-change.negative { color: #f44336; }
        .coin-time {
            font-size: 10px;
            color: #888;
            margin-top: 2px;
        }
        
        /* Side Menu */
        .side-menu {
            position: fixed;
            left: -100%;
            top: 0;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }
        .side-menu.active { left: 0; }
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        .menu-overlay.active { display: block; }
        .menu-header {
            background: linear-gradient(135deg, #4285f4 0%, #1e3c72 100%);
            padding: 25px 20px;
            color: white;
        }
        .menu-brand { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
        .menu-user { font-size: 13px; opacity: 0.9; }
        .menu-items {
            padding: 15px 0;
        }
        .menu-item {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            cursor: pointer;
            transition: background 0.2s;
            gap: 15px;
        }
        .menu-item:hover { background: #f5f5f5; }
        .menu-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .menu-text {
            font-size: 15px;
            font-weight: 500;
            color: #333;
        }
        
        /* Page Container */
        .page {
            display: none;
            min-height: calc(100vh - 200px);
            padding: 20px;
        }
        .page.active { display: block; }
        
        /* Wallet Page */
        .wallet-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        .back-btn {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            border: 1px solid #ddd;
        }
        .wallet-title {
            font-size: 22px;
            font-weight: 600;
            color: #333;
        }
        
        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        .wallet-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .wallet-card:active { transform: scale(0.98); }
        .wallet-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        .wallet-card-name {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }
        .wallet-card-symbol {
            font-size: 11px;
            color: #888;
            margin-bottom: 10px;
        }
        .wallet-card-balance {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }
        .wallet-card-crypto {
            font-size: 11px;
            color: #888;
            margin-top: 3px;
        }
        
        /* Coin Detail Page */
        .coin-detail-header {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .coin-detail-balance {
            text-align: center;
            margin-bottom: 20px;
        }
        .balance-label {
            font-size: 14px;
            color: #888;
            margin-bottom: 8px;
        }
        .balance-amount {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .balance-crypto {
            font-size: 14px;
            color: #666;
        }
        .balance-frozen {
            font-size: 12px;
            color: #888;
            margin-top: 8px;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .action-btn {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .action-btn:active { transform: scale(0.95); }
        
        /* Swap Section */
        .swap-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .swap-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        .swap-input-group {
            margin-bottom: 15px;
        }
        .swap-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            display: block;
        }
        .swap-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            background: white;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .swap-coin-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }
        
        /* Swap Icon Between Coins */
        .swap-icon-container {
            display: flex;
            justify-content: center;
            margin: -10px 0;
            position: relative;
            z-index: 1;
        }
        .swap-icon-btn {
            width: 40px;
            height: 40px;
            background: #4285f4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 20px;
            border: 3px solid #f5f5f5;
            transition: all 0.3s;
        }
        .swap-icon-btn:active { transform: rotate(180deg); }
        
        .amount-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
        }
        .max-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 10px;
        }
        .fee-info {
            font-size: 12px;
            color: #888;
            margin-top: 8px;
        }
        
        /* Trading Section */
        .trading-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .trading-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        .time-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .time-btn {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .time-btn.active { background: #4285f4; color: white; border-color: #4285f4; }
        .time-btn:disabled {
            background: #f5f5f5;
            color: #ccc;
            cursor: not-allowed;
            border-color: #e0e0e0;
        }
        
        .direction-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        .direction-btn {
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .direction-btn.buy-up { background: #4caf50; color: white; }
        .direction-btn.buy-down { background: #f44336; color: white; }
        .direction-btn:active { transform: scale(0.95); }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        .close-btn {
            width: 32px;
            height: 32px;
            background: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            border: none;
        }
        
        /* Withdrawal Form */
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
        }
        .form-input:focus { outline: none; border-color: #4285f4; }
        
        /* Chat Styles */
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        .chat-input-wrapper {
            flex: 1;
            position: relative;
        }
        .chat-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            resize: vertical;
            min-height: 50px;
        }
        .file-input-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #4285f4;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        .file-preview {
            margin-top: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            display: none;
        }
        .file-preview.active { display: block; }
        .file-preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .remove-file-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 5px;
        }
        .send-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            min-width: 80px;
        }
        .chat-message-image {
            max-width: 200px;
            border-radius: 8px;
            margin-top: 8px;
            cursor: pointer;
        }
        
        /* History Table */
        .history-table {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .history-row {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }
        .history-row:hover { background: #f9f9f9; }
        
        /* Overview Cards */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .overview-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .overview-value {
            font-size: 24px;
            font-weight: bold;
            color: #4285f4;
            margin-bottom: 5px;
        }
        .overview-label {
            font-size: 13px;
            color: #888;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .balance-amount { font-size: 28px; }
            .wallet-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Firebase Config -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <!-- Auth Container -->
    <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <!-- Login Form -->
            <div id="loginForm">
                <h2 class="auth-title">Welcome to Hibt</h2>
                <div id="loginMessage"></div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="btn btn-primary" onclick="login()">Login</button>
                <p class="switch-text">Don't have an account? <span class="switch-link" onclick="showRegister()">Register</span></p>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <h2 class="auth-title">Create Account</h2>
                <div id="registerMessage"></div>
                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" id="registerName" placeholder="Enter your full name">
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="registerEmail" placeholder="Enter your email">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="registerPassword" placeholder="Create a password">
                </div>
                <div class="input-group">
                    <label>Phone Number</label>
                    <input type="tel" id="registerPhone" placeholder="Enter your phone number">
                </div>
                <div class="input-group">
                    <label>Country</label>
                    <select id="registerCountry">
                        <option value="">Select Country</option>
                        <option value="United States">United States</option>
                        <option value="United Kingdom">United Kingdom</option>
                        <option value="Canada">Canada</option>
                        <option value="Australia">Australia</option>
                        <option value="Germany">Germany</option>
                        <option value="France">France</option>
                        <option value="India">India</option>
                        <option value="China">China</option>
                        <option value="Japan">Japan</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="register()">Register</button>
                <p class="switch-text">Already have an account? <span class="switch-link" onclick="showLogin()">Login</span></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="app">
        <!-- Menu Overlay -->
        <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
        
        <!-- Side Menu -->
        <div class="side-menu" id="sideMenu">
            <div class="menu-header">
                <div class="menu-brand">Hibt</div>
                <div class="menu-user" id="menuUserInfo">User ID: 00217</div>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="showWalletPage()">
                    <div class="menu-icon">üíº</div>
                    <div class="menu-text">Wallet</div>
                </div>
                <div class="menu-item" onclick="showAccountPage()">
                    <div class="menu-icon">üë§</div>
                    <div class="menu-text">Account</div>
                </div>
                <div class="menu-item" onclick="showOverviewPage()">
                    <div class="menu-icon">üìä</div>
                    <div class="menu-text">Overview</div>
                </div>
                <div class="menu-item" onclick="showHistoryPage()">
                    <div class="menu-icon">üìù</div>
                    <div class="menu-text">History</div>
                </div>
                <div class="menu-item" onclick="openChat()">
                    <div class="menu-icon">üí¨</div>
                    <div class="menu-text">Customer Service Support</div>
                </div>
                <div class="menu-item" onclick="logout()">
                    <div class="menu-icon">üö™</div>
                    <div class="menu-text">Logout</div>
                </div>
            </div>
        </div>

        <!-- Home Page -->
        <div id="homePage" class="page active">
            <div class="header-banner">
                <div class="header-top">
                    <div class="brand">Hibt</div>
                    <div class="header-icons">
                        <button class="icon-btn" onclick="openNotifications()">üîî</button>
                        <button class="icon-btn" onclick="toggleMenu()">‚ò∞</button>
                    </div>
                </div>
                <div class="tagline">Start making money plan.</div>
                
                <!-- Total Assets Display -->
                <div class="total-assets-container">
                    <div class="total-assets-label">Total Assets (USDT)</div>
                    <div class="total-assets-value">
                        <div id="totalAssetsDisplay">
                            <span class="assets-hidden">****.**</span>
                        </div>
                        <div class="eye-icon" onclick="toggleAssetsVisibility()" id="eyeIcon">üëÅÔ∏è</div>
                    </div>
                </div>
                
                <div class="logo-box">üë•</div>
            </div>

            <div class="market-section">
                <div class="section-title">Market</div>
                <div class="coin-list" id="coinList">
                    <!-- Coins will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Wallet Selection Page -->
        <div id="walletPage" class="page">
            <div class="wallet-header">
                <div class="back-btn" onclick="showHomePage()">‚Üê</div>
                <div class="wallet-title">Select a wallet</div>
            </div>
            <div class="wallet-grid" id="walletGrid">
                <!-- Wallets will be loaded here -->
            </div>
        </div>

        <!-- Coin Detail Page -->
        <div id="coinDetailPage" class="page">
            <div class="wallet-header">
                <div class="back-btn" onclick="showWalletPage()">‚Üê</div>
                <div class="wallet-title" id="coinDetailTitle">BTC wallet</div>
            </div>
            
            <div class="coin-detail-header">
                <div class="coin-detail-balance">
                    <div class="balance-label">Available</div>
                    <div class="balance-amount" id="coinBalance">0.0000</div>
                    <div class="balance-crypto" id="coinBalanceCrypto">0.00000000 BTC</div>
                    <div class="balance-frozen" id="coinBalanceFrozen">Frozen: 0.00000000 BTC</div>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" style="background: #e3f2fd; color: #2196f3;" onclick="showSwapSection()">Swap</button>
                    <button class="action-btn" style="background: #e8f5e9; color: #4caf50;" onclick="openDeposit()">Deposit</button>
                    <button class="action-btn" style="background: #fce4ec; color: #e91e63;" onclick="openWithdraw()">Withdraw</button>
                </div>
            </div>

            <!-- Swap Section -->
            <div class="swap-section" id="swapSection" style="display: none;">
                <div class="swap-title">Swap</div>
                <form id="swapForm">
                    <div class="swap-input-group">
                        <label class="swap-label">From</label>
                        <select id="swapFrom" class="form-input" style="padding-left: 50px; background-image: url('data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2220%22 height=%2220%22><circle cx=%2210%22 cy=%2210%22 r=%228%22 fill=%22%23FF9800%22/></svg>'); background-repeat: no-repeat; background-position: 12px center;">
                            <option value="BTC">BTC</option>
                            <option value="ETH">ETH</option>
                            <option value="XRP">XRP</option>
                            <option value="DOGE">DOGE</option>
                            <option value="ADA">ADA</option>
                        </select>
                    </div>
                    
                    <!-- Swap Icon -->
                    <div class="swap-icon-container">
                        <div class="swap-icon-btn" onclick="swapCoins()">‚áÖ</div>
                    </div>
                    
                    <div class="swap-input-group">
                        <label class="swap-label">To</label>
                        <select id="swapTo" class="form-input" style="padding-left: 50px; background-image: url('data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2220%22 height=%2220%22><circle cx=%2210%22 cy=%2210%22 r=%228%22 fill=%22%2326A69A%22/></svg>'); background-repeat: no-repeat; background-position: 12px center;">
                            <option value="USDT">USDT</option>
                            <option value="BTC">BTC</option>
                            <option value="ETH">ETH</option>
                            <option value="XRP">XRP</option>
                            <option value="DOGE">DOGE</option>
                            <option value="ADA">ADA</option>
                        </select>
                    </div>
                    
                    <div class="swap-input-group">
                        <label class="swap-label">Amount</label>
                        <div style="display: flex; align-items: center;">
                            <input type="number" id="swapAmount" class="amount-input" placeholder="0" step="0.00000001">
                            <button type="button" class="max-btn" onclick="setMaxSwapAmount()">Max</button>
                        </div>
                        <div class="fee-info">Available: <span id="swapAvailable">0.00</span> | Fee: 0%</div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="margin-top: 20px;">Execute Swap</button>
                </form>
            </div>

            <!-- Trading Section -->
            <div class="trading-section">
                <div class="trading-title">Quick Trade</div>
                <div class="input-group">
                    <label>Amount (USDT)</label>
                    <input type="number" id="tradeAmount" placeholder="Enter amount" step="0.01" min="1">
                </div>
                <div class="input-group">
                    <label>Contract Time</label>
                    <div class="time-selector">
                        <button type="button" class="time-btn" data-time="30" onclick="selectTime(30)">30s</button>
                        <button type="button" class="time-btn" data-time="90" onclick="selectTime(90)">90s</button>
                        <button type="button" class="time-btn" data-time="120" onclick="selectTime(120)">2min</button>
                    </div>
                </div>
                <div class="input-group">
                    <label>Profit Percentage</label>
                    <select id="profitPercentage">
                        <option value="95">95%</option>
                        <option value="90">90%</option>
                        <option value="85">85%</option>
                    </select>
                </div>
                <div class="direction-selector">
                    <button class="direction-btn buy-up" onclick="executeTrade('up')">Buy Up üìà</button>
                    <button class="direction-btn buy-down" onclick="executeTrade('down')">Buy Down üìâ</button>
                </div>
            </div>
        </div>

        <!-- Account Page -->
        <div id="accountPage" class="page">
            <div class="wallet-header">
                <div class="back-btn" onclick="showHomePage()">‚Üê</div>
                <div class="wallet-title">Account</div>
            </div>
            <div style="background: white; border-radius: 16px; padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; color: #888; margin-bottom: 5px;">Name</div>
                    <div style="font-size: 16px; font-weight: 600;" id="accountName">-</div>
                </div>
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; color: #888; margin-bottom: 5px;">Email</div>
                    <div style="font-size: 16px; font-weight: 600;" id="accountEmail">-</div>
                </div>
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; color: #888; margin-bottom: 5px;">User ID</div>
                    <div style="font-size: 16px; font-weight: 600;" id="accountId">-</div>
                </div>
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; color: #888; margin-bottom: 5px;">Phone</div>
                    <div style="font-size: 16px; font-weight: 600;" id="accountPhone">-</div>
                </div>
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; color: #888; margin-bottom: 5px;">Country</div>
                    <div style="font-size: 16px; font-weight: 600;" id="accountCountry">-</div>
                </div>
                <button class="btn btn-primary" onclick="openChangePassword()">Change Password</button>
            </div>
        </div>

        <!-- Overview Page -->
        <div id="overviewPage" class="page">
            <div class="wallet-header">
                <div class="back-btn" onclick="showHomePage()">‚Üê</div>
                <div class="wallet-title">Overview</div>
            </div>
            <div class="overview-grid">
                <div class="overview-card">
                    <div class="overview-value" id="totalDeposits">$0</div>
                    <div class="overview-label">Total Deposits</div>
                </div>
                <div class="overview-card">
                    <div class="overview-value" id="totalWithdrawals">$0</div>
                    <div class="overview-label">Total Withdrawals</div>
                </div>
                <div class="overview-card">
                    <div class="overview-value" id="totalTrades">0</div>
                    <div class="overview-label">Total Trades</div>
                </div>
                <div class="overview-card">
                    <div class="overview-value" id="totalProfit">$0</div>
                    <div class="overview-label">Total Profit/Loss</div>
                </div>
            </div>
        </div>

        <!-- History Page -->
        <div id="historyPage" class="page">
            <div class="wallet-header">
                <div class="back-btn" onclick="showHomePage()">‚Üê</div>
                <div class="wallet-title">History</div>
            </div>
            <div class="history-table" id="historyTable">
                <div style="text-align: center; padding: 40px; color: #888;">No history yet</div>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div id="depositModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Deposit</div>
                <button class="close-btn" onclick="closeDeposit()">√ó</button>
            </div>
            <div id="depositMessage"></div>
            <div class="form-group">
                <label class="form-label">Amount (USDT)</label>
                <input type="number" id="depositAmount" class="form-input" placeholder="Enter amount" step="0.01">
            </div>
            <div class="form-group">
                <label class="form-label">Transaction ID</label>
                <input type="text" id="depositTxId" class="form-input" placeholder="Enter transaction ID">
            </div>
            <button class="btn btn-primary" onclick="submitDeposit()">Submit Deposit</button>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Withdraw</div>
                <button class="close-btn" onclick="closeWithdraw()">√ó</button>
            </div>
            <div id="withdrawMessage"></div>
            <div class="form-group">
                <label class="form-label">Amount (USDT)</label>
                <input type="number" id="withdrawAmount" class="form-input" placeholder="Enter amount" step="0.01">
            </div>
            <div class="form-group">
                <label class="form-label">Bank Routing Number</label>
                <input type="text" id="withdrawRoutingNumber" class="form-input" placeholder="Enter routing number">
            </div>
            <div class="form-group">
                <label class="form-label">Bank Address</label>
                <input type="text" id="withdrawBankAddress" class="form-input" placeholder="Enter bank address">
            </div>
            <div class="form-group">
                <label class="form-label">Bank Code</label>
                <input type="text" id="withdrawBankCode" class="form-input" placeholder="Enter bank code">
            </div>
            <div class="form-group">
                <label class="form-label">Recipient Address</label>
                <input type="text" id="withdrawRecipientAddress" class="form-input" placeholder="Enter recipient address">
            </div>
            <button class="btn btn-primary" onclick="submitWithdraw()">Submit Withdrawal</button>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Customer Support</div>
                <button class="close-btn" onclick="closeChat()">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div style="text-align: center; color: #888; padding: 20px;">Loading messages...</div>
            </div>
            <div class="file-preview" id="filePreview">
                <div>Selected file: <span id="fileName"></span></div>
                <img id="filePreviewImage" class="file-preview-image" style="display: none;">
                <button class="remove-file-btn" onclick="removeSelectedFile()">Remove</button>
            </div>
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="chatInput" placeholder="Type your message..." rows="2"></textarea>
                    <label for="chatFileInput" class="file-input-btn">üìé</label>
                    <input type="file" id="chatFileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                </div>
                <button class="send-btn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Change Password</div>
                <button class="close-btn" onclick="closeChangePassword()">√ó</button>
            </div>
            <div id="changePasswordMessage"></div>
            <div class="form-group">
                <label class="form-label">Current Password</label>
                <input type="password" id="currentPassword" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">New Password</label>
                <input type="password" id="newPassword" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Confirm New Password</label>
                <input type="password" id="confirmNewPassword" class="form-input">
            </div>
            <button class="btn btn-primary" onclick="changePassword()">Change Password</button>
        </div>
    </div>

    <!-- Trade Detail Modal -->
    <div id="tradeDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Trade Details</div>
                <button class="close-btn" onclick="closeTradeDetail()">√ó</button>
            </div>
            <div id="tradeDetailContent"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBNW6Ka8nYBZbr1l5lnJrEy7l5r_pLI6kI",
            authDomain: "hibit-b6d00.firebaseapp.com",
            projectId: "hibit-b6d00",
            storageBucket: "hibit-b6d00.firebasestorage.app",
            messagingSenderId: "1038710316005",
            appId: "1:1038710316005:web:1bac0c3daec0ee7aa80e01"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global Variables
        let currentUser = null;
        let userId = null;
        let userName = null;
        let userEmail = null;
        let userBalance = { BTC: 0, ETH: 0, XRP: 0, DOGE: 0, ADA: 0, USDT: 0 };
        let selectedCoin = 'BTC';
        let selectedTime = 30;
        let coinPrices = { BTC: 109770.33, ETH: 4030.81, XRP: 2.8131, DOGE: 0.2309, ADA: 1.2456, USDT: 1.00 };
        let chatListener = null;
        let tradeCheckInterval = null;
        let assetsVisible = false;
        let selectedFile = null;
        let selectedFileUrl = null;

        // Navigation Stack
        let navigationStack = ['homePage'];

        // Auth Functions
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showMessage('loginMessage', 'Please fill all fields', 'error');
                return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                showMessage('loginMessage', error.message, 'error');
            }
        }

        async function register() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const phone = document.getElementById('registerPhone').value.trim();
            const country = document.getElementById('registerCountry').value;

            if (!name || !email || !password || !phone || !country) {
                showMessage('registerMessage', 'Please fill all fields', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('registerMessage', 'Password must be at least 6 characters', 'error');
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                const userIdNum = String(Math.floor(10000 + Math.random() * 90000));
                
                await db.collection('users').doc(user.uid).set({
                    userId: userIdNum,
                    name: name,
                    email: email,
                    phone: phone,
                    country: country,
                    balance: { BTC: 0, ETH: 0, XRP: 0, DOGE: 0, ADA: 0, USDT: 0 },
                    frozenBalance: { BTC: 0, ETH: 0, XRP: 0, DOGE: 0, ADA: 0, USDT: 0 },
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    accountFrozen: false
                });

                showMessage('registerMessage', 'Registration successful! Logging in...', 'success');
            } catch (error) {
                showMessage('registerMessage', error.message, 'error');
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                auth.signOut();
            }
        }

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => { element.innerHTML = ''; }, 5000);
        }

        // Load User Data
        async function loadUserData() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    userId = userData.userId;
                    userName = userData.name;
                    userEmail = userData.email;
                    userBalance = userData.balance || { BTC: 0, ETH: 0, XRP: 0, DOGE: 0, ADA: 0, USDT: 0 };
                    
                    document.getElementById('menuUserInfo').textContent = `${userName} | ID: ${userId}`;
                    document.getElementById('accountName').textContent = userName;
                    document.getElementById('accountEmail').textContent = userEmail;
                    document.getElementById('accountId').textContent = userId;
                    document.getElementById('accountPhone').textContent = userData.phone || '-';
                    document.getElementById('accountCountry').textContent = userData.country || '-';
                    
                    updateCoinPrices();
                    loadCoinList();
                    loadWalletGrid();
                    startTradeChecker();
                    updateTotalAssets();
                    updateContractTimeButtons();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Total Assets Functions
        function updateTotalAssets() {
            let totalUsdt = 0;
            for (let coin in userBalance) {
                if (coin === 'USDT') {
                    totalUsdt += userBalance[coin];
                } else {
                    totalUsdt += userBalance[coin] * coinPrices[coin];
                }
            }
            
            const displayElement = document.getElementById('totalAssetsDisplay');
            if (assetsVisible) {
                displayElement.innerHTML = `<span class="total-assets-amount">${totalUsdt.toFixed(2)}</span>`;
            } else {
                displayElement.innerHTML = `<span class="assets-hidden">****.**</span>`;
            }
        }

        function toggleAssetsVisibility() {
            assetsVisible = !assetsVisible;
            const eyeIcon = document.getElementById('eyeIcon');
            eyeIcon.textContent = assetsVisible ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è';
            updateTotalAssets();
        }

        // Update Contract Time Buttons Based on Balance
        function updateContractTimeButtons() {
            const buttons = document.querySelectorAll('.time-btn');
            const usdtBalance = userBalance.USDT || 0;
            
            buttons.forEach(btn => {
                const time = parseInt(btn.getAttribute('data-time'));
                if (time === 90 && usdtBalance < 10) {
                    btn.disabled = true;
                } else if (time === 120 && usdtBalance < 15) {
                    btn.disabled = true;
                } else {
                    btn.disabled = false;
                }
            });
        }

        // Update Coin Prices
        function updateCoinPrices() {
            setInterval(() => {
                for (let coin in coinPrices) {
                    if (coin !== 'USDT') {
                        const change = (Math.random() - 0.5) * coinPrices[coin] * 0.001;
                        coinPrices[coin] = Math.max(0.01, coinPrices[coin] + change);
                    }
                }
                loadCoinList();
                updateTotalAssets();
            }, 5000);
        }

        // Load Coin List
        function loadCoinList() {
            const coinList = document.getElementById('coinList');
            const coins = [
                { name: 'BTC Coin', symbol: 'BTC', icon: '‚Çø', color: '#FF9800', price: coinPrices.BTC },
                { name: 'ETH Coin', symbol: 'ETH', icon: 'Œû', color: '#627EEA', price: coinPrices.ETH },
                { name: 'XRP Coin', symbol: 'XRP', icon: 'X', color: '#23292F', price: coinPrices.XRP },
                { name: 'DOGE Coin', symbol: 'DOGE', icon: '√ê', color: '#C2A633', price: coinPrices.DOGE },
                { name: 'ADA Coin', symbol: 'ADA', icon: '‚Ç≥', color: '#0033AD', price: coinPrices.ADA }
            ];

            coinList.innerHTML = coins.map(coin => {
                const change = ((Math.random() - 0.5) * 10).toFixed(2);
                const isPositive = parseFloat(change) >= 0;
                return `
                    <div class="coin-card">
                        <div class="coin-icon" style="background: ${coin.color};">${coin.icon}</div>
                        <div class="coin-info">
                            <div class="coin-name">${coin.name}</div>
                            <div class="coin-symbol">${coin.symbol}</div>
                        </div>
                        <svg class="coin-graph" viewBox="0 0 60 30">
                            <polyline points="${generateRandomGraph()}" 
                                fill="none" 
                                stroke="${isPositive ? '#4caf50' : '#f44336'}" 
                                stroke-width="2"/>
                        </svg>
                        <div class="coin-price-info">
                            <div class="coin-price">US$ ${coin.price.toFixed(2)}</div>
                            <div class="coin-change ${isPositive ? 'positive' : 'negative'}">
                                ${isPositive ? '+' : ''}${change}%
                            </div>
                            <div class="coin-time">24 Hrs</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function generateRandomGraph() {
            let points = [];
            for (let i = 0; i < 10; i++) {
                points.push(`${i * 7},${Math.random() * 20 + 5}`);
            }
            return points.join(' ');
        }

        // Load Wallet Grid
        function loadWalletGrid() {
            const walletGrid = document.getElementById('walletGrid');
            const wallets = [
                { name: 'BTC wallet', symbol: 'BTC Coin', icon: '‚Çø', color: '#FF9800', balance: userBalance.BTC, price: coinPrices.BTC },
                { name: 'ETH wallet', symbol: 'ETH Coin', icon: 'Œû', color: '#627EEA', balance: userBalance.ETH, price: coinPrices.ETH },
                { name: 'XRP wallet', symbol: 'XRP Coin', icon: 'X', color: '#23292F', balance: userBalance.XRP, price: coinPrices.XRP },
                { name: 'DOGE wallet', symbol: 'DOGE Coin', icon: '√ê', color: '#C2A633', balance: userBalance.DOGE, price: coinPrices.DOGE },
                { name: 'ADA wallet', symbol: 'ADA Coin', icon: '‚Ç≥', color: '#0033AD', balance: userBalance.ADA, price: coinPrices.ADA },
                { name: 'BNB wallet', symbol: 'BNB Coin', icon: 'B', color: '#F3BA2F', balance: 0, price: 0 },
                { name: 'SOL wallet', symbol: 'SOL Coin', icon: 'S', color: '#9945FF', balance: 0, price: 0 },
                { name: 'LINK wallet', symbol: 'LINK Coin', icon: 'L', color: '#2A5ADA', balance: 0, price: 0 }
            ];

            walletGrid.innerHTML = wallets.map(wallet => {
                const usdValue = wallet.balance * wallet.price;
                return `
                    <div class="wallet-card" onclick="showCoinDetail('${wallet.name.split(' ')[0]}')">
                        <div class="wallet-card-icon" style="background: ${wallet.color};">${wallet.icon}</div>
                        <div class="wallet-card-name">${wallet.name}</div>
                        <div class="wallet-card-symbol">${wallet.symbol}</div>
                        <div class="wallet-card-balance">US$ ${usdValue.toFixed(4)}</div>
                        <div class="wallet-card-crypto">${wallet.balance.toFixed(8)} ${wallet.name.split(' ')[0]}</div>
                    </div>
                `;
            }).join('');
        }

        // Navigation Functions
        function toggleMenu() {
            document.getElementById('sideMenu').classList.toggle('active');
            document.getElementById('menuOverlay').classList.toggle('active');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // Update navigation stack
            const currentPageIndex = navigationStack.indexOf(pageId);
            if (currentPageIndex >= 0) {
                navigationStack = navigationStack.slice(0, currentPageIndex + 1);
            } else {
                navigationStack.push(pageId);
            }
        }

        function goBack() {
            if (navigationStack.length > 1) {
                navigationStack.pop();
                const previousPage = navigationStack[navigationStack.length - 1];
                showPage(previousPage);
            }
        }

        function showHomePage() {
            navigationStack = ['homePage'];
            showPage('homePage');
        }

        function showWalletPage() {
            toggleMenu();
            showPage('walletPage');
        }

        function showAccountPage() {
            toggleMenu();
            showPage('accountPage');
        }

        function showOverviewPage() {
            toggleMenu();
            showPage('overviewPage');
            loadOverviewData();
        }

        function showHistoryPage() {
            toggleMenu();
            showPage('historyPage');
            loadHistoryData();
        }

        function showCoinDetail(coin) {
            selectedCoin = coin;
            document.getElementById('coinDetailTitle').textContent = `${coin} wallet`;
            
            const balance = userBalance[coin] || 0;
            const usdValue = balance * coinPrices[coin];
            
            document.getElementById('coinBalance').textContent = `US$ ${usdValue.toFixed(4)}`;
            document.getElementById('coinBalanceCrypto').textContent = `${balance.toFixed(8)} ${coin}`;
            
            // Load frozen balance
            loadFrozenBalance(coin);
            
            document.getElementById('swapFrom').value = coin;
            document.getElementById('swapAvailable').textContent = balance.toFixed(8);
            
            showPage('coinDetailPage');
            document.getElementById('swapSection').style.display = 'none';
            updateContractTimeButtons();
        }

        async function loadFrozenBalance(coin) {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const frozenBalance = userDoc.data().frozenBalance || {};
                    const frozen = frozenBalance[coin] || 0;
                    document.getElementById('coinBalanceFrozen').textContent = `Frozen: ${frozen.toFixed(8)} ${coin}`;
                }
            } catch (error) {
                console.error('Error loading frozen balance:', error);
            }
        }

        function showSwapSection() {
            document.getElementById('swapSection').style.display = 'block';
        }

        // Swap Functions
        function swapCoins() {
            const fromSelect = document.getElementById('swapFrom');
            const toSelect = document.getElementById('swapTo');
            
            const temp = fromSelect.value;
            fromSelect.value = toSelect.value;
            toSelect.value = temp;
            
            updateSwapAvailable();
        }

        function updateSwapAvailable() {
            const fromCoin = document.getElementById('swapFrom').value;
            const balance = userBalance[fromCoin] || 0;
            document.getElementById('swapAvailable').textContent = balance.toFixed(8);
        }

        function setMaxSwapAmount() {
            const fromCoin = document.getElementById('swapFrom').value;
            const balance = userBalance[fromCoin] || 0;
            document.getElementById('swapAmount').value = balance;
        }

        document.getElementById('swapForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fromCoin = document.getElementById('swapFrom').value;
            const toCoin = document.getElementById('swapTo').value;
            const amount = parseFloat(document.getElementById('swapAmount').value);

            if (!amount || amount <= 0) {
                showNotification('‚ùå Please enter a valid amount');
                return;
            }

            const fromBalance = userBalance[fromCoin] || 0;
            if (amount > fromBalance) {
                showNotification('‚ùå Insufficient balance');
                return;
            }

            try {
                const fromValue = amount * coinPrices[fromCoin];
                const toAmount = fromValue / coinPrices[toCoin];

                userBalance[fromCoin] -= amount;
                userBalance[toCoin] = (userBalance[toCoin] || 0) + toAmount;

                await db.collection('users').doc(currentUser.uid).update({
                    balance: userBalance
                });

                showNotification(`‚úÖ Swapped ${amount.toFixed(8)} ${fromCoin} to ${toAmount.toFixed(8)} ${toCoin}`);
                document.getElementById('swapAmount').value = '';
                loadWalletGrid();
                showCoinDetail(toCoin);
                updateTotalAssets();
            } catch (error) {
                showNotification('‚ùå Swap failed: ' + error.message);
            }
        });

        // Trading Functions
        function selectTime(time) {
            selectedTime = time;
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.getAttribute('data-time')) === time) {
                    btn.classList.add('active');
                }
            });
        }

        async function executeTrade(direction) {
            const amount = parseFloat(document.getElementById('tradeAmount').value);
            const percentage = parseInt(document.getElementById('profitPercentage').value);

            if (!amount || amount <= 0) {
                showNotification('‚ùå Please enter amount');
                return;
            }

            if (amount < 1) {
                showNotification('‚ùå Minimum trade amount is 1 USDT');
                return;
            }

            if (!userBalance.USDT || userBalance.USDT < amount) {
                showNotification('‚ùå Insufficient USDT balance');
                return;
            }

            try {
                const purchasePrice = coinPrices[selectedCoin];
                const purchaseTime = Date.now();
                const deliveryTime = purchaseTime + (selectedTime * 1000);

                userBalance.USDT -= amount;
                await db.collection('users').doc(currentUser.uid).update({
                    balance: userBalance
                });

                await db.collection('trades').add({
                    userId: currentUser.uid,
                    userIdNumber: userId,
                    coin: selectedCoin,
                    amount: amount,
                    direction: direction,
                    timeFrame: selectedTime,
                    percentage: percentage,
                    purchasePrice: purchasePrice,
                    purchaseTime: firebase.firestore.Timestamp.fromMillis(purchaseTime),
                    deliveryTime: firebase.firestore.Timestamp.fromMillis(deliveryTime),
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showNotification(`‚úÖ Trade placed: ${direction.toUpperCase()} ${amount} USDT on ${selectedCoin}`);
                document.getElementById('tradeAmount').value = '';
                loadWalletGrid();
                updateTotalAssets();
                updateContractTimeButtons();
            } catch (error) {
                showNotification('‚ùå Trade failed: ' + error.message);
                userBalance.USDT += amount;
                await db.collection('users').doc(currentUser.uid).update({
                    balance: userBalance
                });
            }
        }

        // Trade Checker
        function startTradeChecker() {
            if (tradeCheckInterval) clearInterval(tradeCheckInterval);
            
            tradeCheckInterval = setInterval(async () => {
                try {
                    const snapshot = await db.collection('trades')
                        .where('userId', '==', currentUser.uid)
                        .where('status', '==', 'pending')
                        .get();

                    const now = Date.now();
                    
                    for (const doc of snapshot.docs) {
                        const trade = doc.data();
                        const deliveryTime = trade.deliveryTime.toMillis();
                        
                        if (now >= deliveryTime) {
                            const currentPrice = coinPrices[trade.coin];
                            const purchasePrice = trade.purchasePrice;
                            
                            let result = 'loss';
                            if (trade.direction === 'up' && currentPrice > purchasePrice) {
                                result = 'win';
                            } else if (trade.direction === 'down' && currentPrice < purchasePrice) {
                                result = 'win';
                            }
                            
                            const profit = result === 'win' ? trade.amount * (trade.percentage / 100) : 0;
                            const returnAmount = result === 'win' ? trade.amount + profit : 0;
                            
                            await db.collection('trades').doc(doc.id).update({
                                status: result,
                                finalPrice: currentPrice,
                                profit: profit,
                                completedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            
                            if (result === 'win') {
                                userBalance.USDT += returnAmount;
                                await db.collection('users').doc(currentUser.uid).update({
                                    balance: userBalance
                                });
                                showNotification(`üéâ Trade won! +${profit.toFixed(2)} USDT`);
                            } else {
                                showNotification(`üòû Trade lost: -${trade.amount.toFixed(2)} USDT`);
                            }
                            
                            loadWalletGrid();
                            updateTotalAssets();
                            updateContractTimeButtons();
                        }
                    }
                } catch (error) {
                    console.error('Error checking trades:', error);
                }
            }, 5000);
        }

        // Deposit Functions
        function openDeposit() {
            document.getElementById('depositModal').classList.add('active');
        }

        function closeDeposit() {
            document.getElementById('depositModal').classList.remove('active');
        }

        async function submitDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const txId = document.getElementById('depositTxId').value.trim();

            if (!amount || amount <= 0) {
                showMessage('depositMessage', 'Please enter a valid amount', 'error');
                return;
            }

            if (!txId) {
                showMessage('depositMessage', 'Please enter transaction ID', 'error');
                return;
            }

            try {
                await db.collection('deposits').add({
                    userId: currentUser.uid,
                    userIdNumber: userId,
                    userName: userName,
                    amount: amount,
                    txId: txId,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                await db.collection('transactions').add({
                    userId: currentUser.uid,
                    type: 'deposit',
                    amount: amount,
                    status: 'pending',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                showMessage('depositMessage', 'Deposit request submitted! Waiting for approval.', 'success');
                document.getElementById('depositAmount').value = '';
                document.getElementById('depositTxId').value = '';
                
                setTimeout(() => closeDeposit(), 2000);
            } catch (error) {
                showMessage('depositMessage', error.message, 'error');
            }
        }

        // Withdraw Functions
        function openWithdraw() {
            document.getElementById('withdrawModal').classList.add('active');
        }

        function closeWithdraw() {
            document.getElementById('withdrawModal').classList.remove('active');
        }

        async function submitWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const routingNumber = document.getElementById('withdrawRoutingNumber').value.trim();
            const bankAddress = document.getElementById('withdrawBankAddress').value.trim();
            const bankCode = document.getElementById('withdrawBankCode').value.trim();
            const recipientAddress = document.getElementById('withdrawRecipientAddress').value.trim();

            if (!amount || amount <= 0) {
                showMessage('withdrawMessage', 'Please enter a valid amount', 'error');
                return;
            }

            if (!routingNumber || !bankAddress || !bankCode || !recipientAddress) {
                showMessage('withdrawMessage', 'Please fill all bank details', 'error');
                return;
            }

            if (userBalance.USDT < amount) {
                showMessage('withdrawMessage', 'Insufficient USDT balance', 'error');
                return;
            }

            try {
                await db.collection('withdrawals').add({
                    userId: currentUser.uid,
                    userIdNumber: userId,
                    userName: userName,
                    amount: amount,
                    routingNumber: routingNumber,
                    bankAddress: bankAddress,
                    bankCode: bankCode,
                    recipientAddress: recipientAddress,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                await db.collection('transactions').add({
                    userId: currentUser.uid,
                    type: 'withdrawal',
                    amount: amount,
                    status: 'pending',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                showMessage('withdrawMessage', 'Withdrawal request submitted! Waiting for approval.', 'success');
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('withdrawRoutingNumber').value = '';
                document.getElementById('withdrawBankAddress').value = '';
                document.getElementById('withdrawBankCode').value = '';
                document.getElementById('withdrawRecipientAddress').value = '';
                
                setTimeout(() => closeWithdraw(), 2000);
            } catch (error) {
                showMessage('withdrawMessage', error.message, 'error');
            }
        }

        // Overview Functions
        async function loadOverviewData() {
            try {
                const transSnapshot = await db.collection('transactions')
                    .where('userId', '==', currentUser.uid)
                    .get();

                let totalDeposits = 0;
                let totalWithdrawals = 0;

                transSnapshot.forEach(doc => {
                    const trans = doc.data();
                    if (trans.type === 'deposit' && trans.status === 'approved') {
                        totalDeposits += trans.amount;
                    } else if (trans.type === 'withdrawal' && trans.status === 'approved') {
                        totalWithdrawals += trans.amount;
                    }
                });

                const tradesSnapshot = await db.collection('trades')
                    .where('userId', '==', currentUser.uid)
                    .get();

                let totalTrades = 0;
                let totalProfit = 0;

                tradesSnapshot.forEach(doc => {
                    const trade = doc.data();
                    totalTrades++;
                    if (trade.status === 'win') {
                        totalProfit += trade.profit || 0;
                    } else if (trade.status === 'loss') {
                        totalProfit -= trade.amount || 0;
                    }
                });

                document.getElementById('totalDeposits').textContent = `$${totalDeposits.toFixed(2)}`;
                document.getElementById('totalWithdrawals').textContent = `$${totalWithdrawals.toFixed(2)}`;
                document.getElementById('totalTrades').textContent = totalTrades;
                document.getElementById('totalProfit').textContent = `$${totalProfit.toFixed(2)}`;
                document.getElementById('totalProfit').style.color = totalProfit >= 0 ? '#4caf50' : '#f44336';
            } catch (error) {
                console.error('Error loading overview:', error);
            }
        }

        // History Functions
        async function loadHistoryData() {
            try {
                const snapshot = await db.collection('trades')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();

                const historyTable = document.getElementById('historyTable');
                
                if (snapshot.empty) {
                    historyTable.innerHTML = '<div style="text-align: center; padding: 40px; color: #888;">No history yet</div>';
                    return;
                }

                let html = '';
                snapshot.forEach(doc => {
                    const trade = doc.data();
                    const statusColor = trade.status === 'win' ? '#4caf50' : trade.status === 'loss' ? '#f44336' : '#ff9800';
                    const statusText = trade.status === 'win' ? 'WIN' : trade.status === 'loss' ? 'LOSS' : 'PENDING';
                    
                    html += `
                        <div class="history-row" onclick="showTradeDetail('${doc.id}')">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600; font-size: 15px;">${trade.coin} ${trade.direction === 'up' ? 'üìà' : 'üìâ'}</div>
                                    <div style="font-size: 12px; color: #888; margin-top: 3px;">${trade.amount.toFixed(2)} USDT | ${trade.timeFrame}s</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: 600; color: ${statusColor};">${statusText}</div>
                                    <div style="font-size: 12px; color: #888; margin-top: 3px;">
                                        ${trade.createdAt ? new Date(trade.createdAt.toMillis()).toLocaleDateString() : 'N/A'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                historyTable.innerHTML = html;
            } catch (error) {
                console.error('Error loading history:', error);
                document.getElementById('historyTable').innerHTML = '<div style="text-align: center; padding: 40px; color: #888;">Error loading history</div>';
            }
        }

        async function showTradeDetail(tradeId) {
            try {
                const doc = await db.collection('trades').doc(tradeId).get();
                if (!doc.exists) return;

                const trade = doc.data();
                const purchaseTime = trade.purchaseTime ? trade.purchaseTime.toMillis() : 0;
                const deliveryTime = trade.deliveryTime ? trade.deliveryTime.toMillis() : 0;
                const endTime = deliveryTime;
                
                const purchaseTimeStr = purchaseTime ? new Date(purchaseTime).toLocaleString() : 'N/A';
                const deliveryTimeStr = deliveryTime ? new Date(deliveryTime).toLocaleString() : 'N/A';

                const resultHtml = trade.status === 'win' ?
                `<div style="padding: 15px; background: #e8f5e9; border-radius: 10px; margin-top: 15px;">
                    <div style="font-weight: 600; color: #4caf50; font-size: 16px;">WIN</div>
                    <div style="color: #4caf50; font-size: 20px; font-weight: bold; margin-top: 5px;">
                        +${(trade.profit || 0).toFixed(2)} USDT
                    </div>
                </div>` :
                trade.status === 'loss' ?
                `<div style="padding: 15px; background: #ffebee; border-radius: 10px; margin-top: 15px;">
                    <div style="font-weight: 600; color: #f44336; font-size: 16px;">LOSS</div>
                    <div style="color: #f44336; font-size: 20px; font-weight: bold; margin-top: 5px;">
                        -${trade.amount.toFixed(2)} USDT
                    </div>
                </div>` :
                `<div style="padding: 15px; background: #fff3e0; border-radius: 10px; margin-top: 15px;">
                    <div style="font-weight: 600; color: #ff9800; font-size: 16px;">PENDING</div>
                </div>`;

                document.getElementById('tradeDetailContent').innerHTML = `
                    <div style="padding: 20px 0;">
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div style="font-size: 13px; color: #888; margin-bottom: 5px;">Coin</div>
                            <div style="font-size: 18px; font-weight: 600;">${trade.coin}</div>
                        </div>
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div style="font-size: 13px; color: #888; margin-bottom: 5px;">Purchase Amount</div>
                            <div style="font-size: 18px; font-weight: 600;">${trade.amount.toFixed(2)} USDT</div>
                        </div>
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div style="font-size: 13px; color: #888; margin-bottom: 5px;">Direction</div>
                            <div style="font-size: 16px; font-weight: 600; color: ${trade.direction === 'up' ? '#4caf50' : '#f44336'};">
                                ${trade.direction === 'up' ? 'üìà Buy Up' : 'üìâ Buy Down'}
                            </div>
                        </div>
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div style="font-size: 13px; color: #888; margin-bottom: 5px;">Contract Time</div>
                            <div style="font-size: 16px; font-weight: 600;">${trade.timeFrame} Seconds</div>
                        </div>
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div style="font-size: 13px; color: #888; margin-bottom: 5px;">Profit Percentage</div>
                            <div style="font-size: 16px; font-weight: 600;">${trade.percentage}%</div>
                        </div>
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div style="font-size: 13px; color: #888; margin-bottom: 5px;">Purchase Price</div>
                            <div style="font-size: 16px; font-weight: 600;">$${(trade.purchasePrice || 0).toFixed(2)}</div>
                        </div>
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div style="font-size: 13px; color: #888; margin-bottom: 5px;">Purchase Time</div>
                            <div style="font-size: 14px;">${purchaseTimeStr}</div>
                        </div>
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;">
                            <div style="font-size: 13px; color: #888; margin-bottom: 5px;">Delivery Time</div>
                            <div style="font-size: 14px;">${deliveryTimeStr}</div>
                        </div>
                        ${resultHtml}
                    </div>
                `;

                document.getElementById('tradeDetailModal').classList.add('active');
                
                if (trade.status === 'pending') {
                    const countdownInterval = setInterval(() => {
                        const nowMs = Date.now();
                        const remainingMs = Math.max(0, endTime - nowMs);
                        const remainingSec = Math.floor(remainingMs / 1000);
                        
                        if (remainingSec <= 0) {
                            clearInterval(countdownInterval);
                            closeTradeDetail();
                            loadHistoryData();
                        }
                    }, 1000);
                }
            } catch (error) {
                console.error('Error showing trade detail:', error);
            }
        }

        function closeTradeDetail() {
            document.getElementById('tradeDetailModal').classList.remove('active');
        }

        // Password Change
        function openChangePassword() {
            document.getElementById('changePasswordModal').classList.add('active');
        }

        function closeChangePassword() {
            document.getElementById('changePasswordModal').classList.remove('active');
        }

        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showMessage('changePasswordMessage', 'Please fill all fields', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showMessage('changePasswordMessage', 'New password must be at least 6 characters', 'error');
                return;
            }

            if (newPassword !== confirmNewPassword) {
                showMessage('changePasswordMessage', 'New passwords do not match', 'error');
                return;
            }

            try {
                const user = auth.currentUser;
                const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);

                await user.reauthenticateWithCredential(credential);
                await user.updatePassword(newPassword);

                showMessage('changePasswordMessage', 'Password changed successfully!', 'success');
                setTimeout(() => {
                    closeChangePassword();
                }, 2000);
            } catch (error) {
                showMessage('changePasswordMessage', error.message, 'error');
            }
        }

        // Notifications
        function openNotifications() {
            showNotification('No new notifications');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #333;
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 3000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Chat Functions
        function openChat() {
            toggleMenu();
            document.getElementById('chatModal').classList.add('active');
            loadChatMessages();
        }

        function closeChat() {
            document.getElementById('chatModal').classList.remove('active');
            if (chatListener) {
                chatListener();
                chatListener = null;
            }
            removeSelectedFile();
        }

        function loadChatMessages() {
            const chatMessages = document.getElementById('chatMessages');
            
            if (chatListener) {
                chatListener();
                chatListener = null;
            }
            
            chatListener = db.collection('chats')
                .where('userId', '==', currentUser.uid)
                .onSnapshot(snapshot => {
                    if (snapshot.empty) {
                        chatMessages.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No messages yet</div>';
                        return;
                    }

                    const messages = [];
                    snapshot.forEach(doc => {
                        messages.push({ id: doc.id, ...doc.data() });
                    });
                    
                    messages.sort((a, b) => {
                        const timeA = a.timestamp?.toMillis() || 0;
                        const timeB = b.timestamp?.toMillis() || 0;
                        return timeA - timeB;
                    });

                    let html = '';
                    messages.forEach(msg => {
                        const isUser = msg.senderType === 'user';
                        const time = msg.timestamp ? new Date(msg.timestamp.toMillis()).toLocaleTimeString() : '';
                        
                        html += `
                            <div style="margin-bottom: 15px; text-align: ${isUser ? 'right' : 'left'};">
                                <div style="display: inline-block; max-width: 70%; padding: 10px 15px; border-radius: 12px; background: ${isUser ? '#4285f4' : '#e0e0e0'}; color: ${isUser ? '#fff' : '#333'}; text-align: left;">
                                    <div style="font-weight: 600; font-size: 11px; margin-bottom: 5px; opacity: 0.8;">${isUser ? 'You' : 'Support'}</div>
                                    <div>${msg.message}</div>
                                    ${msg.fileUrl ? `<img src="${msg.fileUrl}" class="chat-message-image" onclick="window.open('${msg.fileUrl}', '_blank')">` : ''}
                                    <div style="font-size: 9px; margin-top: 5px; opacity: 0.7;">${time}</div>
                                </div>
                            </div>
                        `;
                    });

                    chatMessages.innerHTML = html;
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showNotification('‚ùå Please select an image file');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                showNotification('‚ùå File size must be less than 5MB');
                return;
            }

            selectedFile = file;
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('filePreview').classList.add('active');

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.getElementById('filePreviewImage');
                img.src = e.target.result;
                img.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        function removeSelectedFile() {
            selectedFile = null;
            selectedFileUrl = null;
            document.getElementById('chatFileInput').value = '';
            document.getElementById('filePreview').classList.remove('active');
            document.getElementById('filePreviewImage').style.display = 'none';
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message && !selectedFile) return;

            try {
                let fileUrl = null;

                if (selectedFile) {
                    const storageRef = storage.ref();
                    const fileRef = storageRef.child(`chat-files/${currentUser.uid}/${Date.now()}_${selectedFile.name}`);
                    await fileRef.put(selectedFile);
                    fileUrl = await fileRef.getDownloadURL();
                }

                await db.collection('chats').add({
                    userId: currentUser.uid,
                    userIdNumber: userId,
                    userName: userName,
                    userEmail: userEmail,
                    message: message || '(Image)',
                    fileUrl: fileUrl,
                    senderType: 'user',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    read: false
                });

                input.value = '';
                removeSelectedFile();
            } catch (error) {
                console.error('Error sending message:', error);
                showNotification('‚ùå Failed to send message');
            }
        }

        // Initialize Auth State
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('mainApp').classList.add('active');
            } else {
                currentUser = null;
                document.getElementById('authContainer').style.display = 'flex';
                document.getElementById('mainApp').classList.remove('active');
                if (tradeCheckInterval) clearInterval(tradeCheckInterval);
            }
        });

        // Select first time button by default
        document.addEventListener('DOMContentLoaded', () => {
            selectTime(30);
        });
    </script>
</body>
</html>
