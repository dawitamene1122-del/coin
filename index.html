<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hibt - Trading Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f8f9fa; }
        
        /* Auth Container */
        .auth-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .auth-box { background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); width: 90%; max-width: 400px; }
        .auth-title { font-size: 24px; font-weight: 600; margin-bottom: 30px; text-align: center; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; }
        input { width: 100%; padding: 15px; border: 2px solid #e1e5e9; border-radius: 12px; font-size: 16px; }
        input:focus { outline: none; border-color: #667eea; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 20px; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a67d8; }
        .switch-text { margin-top: 20px; color: #6c757d; text-align: center; }
        .switch-link { color: #667eea; cursor: pointer; text-decoration: underline; }
        .message { padding: 10px; border-radius: 8px; margin-bottom: 15px; font-weight: 500; }
        .error { background: #fee; color: #c33; border: 1px solid #fcc; }
        .success { background: #efe; color: #363; border: 1px solid #cfc; }
        .hidden { display: none; }
        
        /* Dashboard */
        .dashboard { display: none; min-height: 100vh; }
        .dashboard.active { display: block; }
        .header { background: linear-gradient(135deg, #4285f4 0%, #3367d6 100%); color: white; padding: 20px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .brand { font-size: 48px; font-weight: bold; }
        .balance-display { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; margin-top: 20px; }
        .balance-label { font-size: 14px; opacity: 0.9; }
        .balance-value { font-size: 32px; font-weight: bold; margin-top: 5px; }
        .logout-btn { background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; }
        
        .market-section { padding: 20px; }
        .section-title { font-size: 28px; font-weight: bold; margin-bottom: 20px; }
        .coin-list { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .coin-item { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f1f3f4; cursor: pointer; }
        .coin-item:hover { background: #f8f9fb; }
        .coin-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 15px; }
        .coin-info { flex: 1; }
        .coin-name { font-weight: 600; font-size: 16px; }
        .coin-price { text-align: right; }
        .price-value { font-weight: 600; font-size: 16px; }
        
        /* Trading Modal */
        .trading-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; }
        .trading-modal.active { display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; border-radius: 20px; padding: 30px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-size: 24px; font-weight: 600; }
        .close-btn { background: none; border: none; font-size: 32px; cursor: pointer; color: #666; }
        .trade-section { margin-bottom: 20px; }
        .trade-label { font-weight: 600; margin-bottom: 10px; }
        .direction-btns { display: flex; gap: 10px; }
        .direction-btn { flex: 1; padding: 15px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; }
        .direction-btn.up { background: #4caf50; color: white; }
        .direction-btn.down { background: #f44336; color: white; }
        .direction-btn.inactive { background: #e9ecef; color: #666; }
        .trade-input { width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 16px; margin-top: 10px; }
        .trade-btn { width: 100%; padding: 18px; background: #4285f4; color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; margin-top: 20px; }
        .trade-btn:hover { background: #3367d6; }
        
        /* Coin colors */
        .btc { background: #f7931a; }
        .eth { background: #627eea; }
        .xrp { background: #23292f; }
        .doge { background: #c2a633; }
        .ada { background: #0033ad; }
        .bnb { background: #f3ba2f; }
    </style>
</head>
<body>
    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <!-- Register Form -->
            <div id="registerForm">
                <h2 class="auth-title">Create Account</h2>
                <div id="authMessage"></div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="regEmail" placeholder="Enter email">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="regPassword" placeholder="Enter password">
                </div>
                <button class="btn btn-primary" onclick="register()">Register</button>
                <div class="switch-text">
                    Already have an account? <span class="switch-link" onclick="showLogin()">Sign In</span>
                </div>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="hidden">
                <h2 class="auth-title">Sign In</h2>
                <div id="loginMessage"></div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter email">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password">
                </div>
                <button class="btn btn-primary" onclick="login()">Sign In</button>
                <div class="switch-text">
                    Don't have an account? <span class="switch-link" onclick="showRegister()">Register</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="header">
            <div class="header-top">
                <div class="brand">Hibt</div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            <div class="balance-display">
                <div class="balance-label">Your Balance</div>
                <div class="balance-value" id="userBalance">0.00 USDT</div>
            </div>
        </div>

        <div class="market-section">
            <h2 class="section-title">Markets</h2>
            <div class="coin-list" id="coinList"></div>
        </div>
    </div>

    <!-- Trading Modal -->
    <div class="trading-modal" id="tradingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Trade</h2>
                <button class="close-btn" onclick="closeTradeModal()">&times;</button>
            </div>
            
            <div id="tradeMessage"></div>
            
            <div class="trade-section">
                <div class="trade-label">Direction</div>
                <div class="direction-btns">
                    <button class="direction-btn up" id="upBtn" onclick="selectDirection('up')">Buy Up</button>
                    <button class="direction-btn down inactive" id="downBtn" onclick="selectDirection('down')">Buy Down</button>
                </div>
            </div>

            <div class="trade-section">
                <div class="trade-label">Amount (USDT)</div>
                <input type="number" class="trade-input" id="tradeAmount" placeholder="Enter amount" min="1">
                <div style="margin-top: 10px; color: #666; font-size: 14px;">
                    Available: <span id="availableBalance">0.00</span> USDT
                </div>
            </div>

            <div class="trade-section">
                <div class="trade-label">Time Frame</div>
                <select class="trade-input" id="timeFrame">
                    <option value="60">60 Seconds</option>
                    <option value="120">2 Minutes</option>
                    <option value="300">5 Minutes</option>
                </select>
            </div>

            <button class="trade-btn" onclick="executeTrade()">Execute Trade</button>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDWQBTrvvxCL5Qd23iSMTQlWkaPKZgjhqw",
            authDomain: "trading-dapp-d5aa4.firebaseapp.com",
            projectId: "trading-dapp-d5aa4",
            storageBucket: "trading-dapp-d5aa4.firebasestorage.app",
            messagingSenderId: "690266747119",
            appId: "1:690266747119:web:0f22d45fbee53ee3c3eb1a"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let userBalance = 0;
        let selectedCoin = null;
        let tradeDirection = 'up';

        const coins = [
            { name: 'BTC', fullName: 'Bitcoin', class: 'btc', price: 109770.33 },
            { name: 'ETH', fullName: 'Ethereum', class: 'eth', price: 4030.81 },
            { name: 'XRP', fullName: 'Ripple', class: 'xrp', price: 2.8131 },
            { name: 'DOGE', fullName: 'Dogecoin', class: 'doge', price: 0.2309 },
            { name: 'ADA', fullName: 'Cardano', class: 'ada', price: 1.2456 },
            { name: 'BNB', fullName: 'Binance Coin', class: 'bnb', price: 692.45 }
        ];

        // Auth State Listener
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                showDashboard();
            } else {
                showAuth();
            }
        });

        // Register
        async function register() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            if (!email || !password) {
                showMessage('authMessage', 'Please fill all fields', 'error');
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Create user document in Firestore
                await db.collection('users').doc(user.uid).set({
                    email: email,
                    balance: 1000, // Starting balance
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showMessage('authMessage', 'Account created successfully!', 'success');
            } catch (error) {
                showMessage('authMessage', error.message, 'error');
            }
        }

        // Login
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showMessage('loginMessage', 'Please fill all fields', 'error');
                return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
                showMessage('loginMessage', 'Login successful!', 'success');
            } catch (error) {
                showMessage('loginMessage', error.message, 'error');
            }
        }

        // Logout
        function logout() {
            auth.signOut();
        }

        // Load User Data
        async function loadUserData() {
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            if (userDoc.exists) {
                const userData = userDoc.data();
                userBalance = userData.balance || 0;
                document.getElementById('userBalance').textContent = userBalance.toFixed(2) + ' USDT';
            }
        }

        // Show/Hide Functions
        function showAuth() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('active');
        }

        function showDashboard() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            renderCoins();
        }

        function showRegister() {
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
        }

        function showLogin() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        function showMessage(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => { el.innerHTML = ''; }, 3000);
        }

        // Render Coins
        function renderCoins() {
            const coinList = document.getElementById('coinList');
            coinList.innerHTML = coins.map((coin, index) => `
                <div class="coin-item" onclick="openTrade(${index})">
                    <div class="coin-icon ${coin.class}">${coin.name}</div>
                    <div class="coin-info">
                        <div class="coin-name">${coin.fullName}</div>
                    </div>
                    <div class="coin-price">
                        <div class="price-value">$${coin.price.toLocaleString()}</div>
                    </div>
                </div>
            `).join('');
        }

        // Trading Functions
        function openTrade(index) {
            selectedCoin = coins[index];
            document.getElementById('modalTitle').textContent = `Trade ${selectedCoin.fullName}`;
            document.getElementById('availableBalance').textContent = userBalance.toFixed(2);
            document.getElementById('tradingModal').classList.add('active');
        }

        function closeTradeModal() {
            document.getElementById('tradingModal').classList.remove('active');
            document.getElementById('tradeAmount').value = '';
        }

        function selectDirection(direction) {
            tradeDirection = direction;
            document.getElementById('upBtn').className = direction === 'up' ? 'direction-btn up' : 'direction-btn up inactive';
            document.getElementById('downBtn').className = direction === 'down' ? 'direction-btn down' : 'direction-btn down inactive';
        }

        // Execute Trade
        async function executeTrade() {
            const amount = parseFloat(document.getElementById('tradeAmount').value);
            const timeFrame = document.getElementById('timeFrame').value;

            if (!amount || amount < 1) {
                showMessage('tradeMessage', 'Minimum amount is 1 USDT', 'error');
                return;
            }

            if (amount > userBalance) {
                showMessage('tradeMessage', 'Insufficient balance', 'error');
                return;
            }

            try {
                // Deduct balance
                const newBalance = userBalance - amount;
                await db.collection('users').doc(currentUser.uid).update({
                    balance: newBalance
                });

                // Create trade record
                await db.collection('trades').add({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    coin: selectedCoin.name,
                    amount: amount,
                    direction: tradeDirection,
                    timeFrame: parseInt(timeFrame),
                    status: 'pending',
                    result: null,
                    profit: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                userBalance = newBalance;
                document.getElementById('userBalance').textContent = userBalance.toFixed(2) + ' USDT';
                
                showMessage('tradeMessage', 'Trade executed! Result will be determined shortly.', 'success');
                
                setTimeout(() => {
                    closeTradeModal();
                }, 2000);

            } catch (error) {
                showMessage('tradeMessage', 'Trade failed: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
